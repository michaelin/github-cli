if [ ! -d "$HOME/.config" ]
then
    mkdir $HOME/.config
fi

ssh-add -l &>/dev/null
if [ "$?" != 0 ]
then
    echo "Please start an ssh-agent and add the ssh key you use for Github."
    echo ""
    echo "To start the agent and add your main ssh key, run"
    echo "   eval \$(ssh-agent -s)"
    echo "   ssh-add"
    echo ""
    echo "For more advanced ssh-agent usage, see http://rabexc.org/posts/pitfalls-of-ssh-agents"
    echo ""
else
    docker run -it --rm \
        --user $(id -u):$(id -g) \
        -v $PWD:/git -w /git \
        -v $HOME/.config:/home/bitnami/.config \
        -v $(dirname $SSH_AUTH_SOCK):$(dirname $SSH_AUTH_SOCK) \
        -e SSH_AUTH_SOCK=$SSH_AUTH_SOCK \
        -e GITHUB_TOKEN \
        michaelin/github-cli \
        $*
fi